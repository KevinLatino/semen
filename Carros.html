<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta id="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rentacar</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js">
  </script>
  <style>
    .forms {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: 076391;
    }

    .forms-2 ul {
      list-style: none;
      margin: 0;
      padding: 0;
      width: 400px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .forms-2 li {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }

    .forms-2 li:last-child {
      border-bottom: none;
    }

    .forms-2 input[type="text"],
    .forms-2 input[type="number"],
    .forms-2 input[type="file"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }

    .forms-2 input[type="text"]:focus,
    .forms-2 input[type="number"]:focus,
    .forms-2 input[type="file"]:focus {
      outline: none;
      border-color: #0077ff;
    }

    .forms-2 input[type="button"] {
      background-color: #0077ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 10px 16px;
      margin-top: 10px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    .forms-2 input[type="button"]:hover {
      background-color: #0055cc;
    }

    .forms-2 input[type="file"]::-webkit-file-upload-button {
      background-color: #0077ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 10px 16px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    .forms-2 input[type="file"]::-webkit-file-upload-button:hover {
      background-color: #0055cc;
    }

    .container2 {
      text-align: center;
      justify-content: center;
      align-items: center;
      display: flex;
    }

    .table-fill {
      width: 70%;
      background-color: white;
      border-collapse: collapse;
      height: 320px;
      overflow-y: auto;
    }

    .table-fill th,
    .table-fill td {
      color: #555555;
      border: 1px solid #e8e8e8;
      padding: 12px;
      vertical-align: middle;
    }

    .table-fill th {
      background: #d3f1ff;
      font-weight: bold;
    }

    .table-fill tbody tr:hover {
      background-color: #f6f6f6;
    }

    .text-left {
      text-align: left;
    }

    /* Estilos generales */
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #076391;
    }

    h1 {
      text-align: center;
      margin-top: 50px;
      font-size: 26px;
      color: #fff;
    }

    /* Estilos del formulario */
    .container {
      margin: 0 auto;
      width: 50%;
      max-width: 600px;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .container h2 {
      font-size: 28px;
      margin-bottom: 30px;
    }

    .container div {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    .container span {
      margin-bottom: 10px;
      font-weight: bold;
      color: #555;
    }

    .container input[type="text"],
    .container input[type="number"],
    .container input[type="file"] {
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 18px;
      background-color: #c4ebfd;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.2s ease-in-out;
    }

    .container input[type="text"]:focus,
    .container input[type="number"]:focus,
    .container input[type="file"]:focus {
      outline: none;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .container input[type="file"] {
      padding: 15px 10px;
      text-align: center;
      color: #777;
    }

    .container button {
      padding: 15px 30px;
      border: none;
      border-radius: 5px;
      background-color: #58ace4;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    .container button:hover {
      background-color: #0d6af5;
    }
  </style>
</head>

<body>

  <h1 id="title">Ingrese los datos del carro que desea vender</h1>

  <div class="container">

    <div>
      <span>Tipo:</span>
      <input type="text" id="modelo" required>
    </div>

    <div>
      <span>Motor:</span>
      <input type="text" id="motor" required>
    </div>


    <div>
      <span>Marca:</span>
      <input type="text" id="marca" required>
    </div>
    <div>
      <span>Agencia:</span>
      <input type="text" id="agencia" required>
    </div>

  </div>

  <div class="container">
    <div>
      <span>Color:</span>
      <input type="text" id="color" required>
    </div>
    <div>
      <span>Asientos:</span>
      <input type="number" id="asientos" required>
    </div>

    <div>
      <span>Placa:</span>
      <input type="text" id="placa">
    </div>


    <div>
      <span>Año:</span>
      <input type="number" id="anio">
    </div>

  </div>

  <div class="container">
    <div>
      <span>Precio dólares:</span>
      <input type="number" id="precio" min="18" max="100" required>
    </div>

    <div>
      <span>Imagen:</span>
      <input type="file" id="img" required>
    </div>

    <button onclick="realizar()">Enviar</button>

  </div>

  <br> <br> <br> <br>

  <div class="container2">
    <table class="table-fill">

      <thead>
        <tr>
          <th class="text-left">Tipo</th>
          <th class="text-left">Motor</th>
          <th class="text-left">Marca</th>
          <th class="text-left">Agencia</th>
          <th class="text-left">Color</th>
          <th class="text-left">Asientos</th>
          <th class="text-left">Placa</th>
          <th class="text-left">Año</th>
          <th class="text-left">Precio en dólares</th>
          <th class="text-left">Estado</th>
          <th class="text-left">Imagen</th>
          <th class="text-left">Eliminar</th>
          <th class="text-left">Modificar</th>
          <th class="text-left">Comprar</th>
        </tr>
      </thead>
      <tbody class="table-hover" id="cuerpotabla"></tbody>
    </table>
  </div>
  <br> <br> <br>
  <div class="forms-2 forms" id="modificar-div">
    <ul>
      <li><input type="text" name="modelo" id="modeloMod" placeholder="Modifique el tipo" required></li>
      <li><input type="text" name="motor" id="motorMod" placeholder="Modifique el motor" required></li>
      <li><input type="text" name="marca" id="marcaMod" placeholder="Modifique la marca" required></li>
      <li><input type="text" name="agencia" id="agenciaMod" placeholder="Modifique la agencia" required></li>
      <li><input type="text" name="color" id="colorMod" placeholder="Modifique el color" required></li>
      <li><input type="number" name="asientos" id="asientosMod" placeholder="Modifique los asientos" required></li>
      <li><input type="text" name="placa" id="placaMod" placeholder="Modifique la placa" required></li>
      <li><input type="text" name="anio" id="anioMod" placeholder="Modifique el año" required></li>
      <li><input type="number" name="precio" id="precioMod" placeholder="Modifique el precio" required></li>
      <li><input type="file" id="imgMod" required></li>
      <li><input class="subir" type="button" value="Subir modificaciones" id="modificado"></li>
    </ul>
  </div>


  <div class="contain" id="contain">

  </div>
</body>

<script src="/peticiones"></script>

<script>
  let Carroinstacia = new Carro();

  let imagenes64 = "";
  $("#img").change(function () {
    readURL(this);
  });
  let reader = new FileReader();
  function readURL(input) {
    if (input.files && input.files[0]) {
      reader.onload = function (e) {
        imagenes64 = e.target.result;
      }
    }
    reader.readAsDataURL(input.files[0]);
  }

  const fillTable = (cars) => {
    const table = document.getElementById("cuerpotabla");

    table.innerHTML = "";

    for (const car of cars) {
      console.log(car);
      table.innerHTML += `
        <tr>
          <td>${car.modelo}</td>
          <td>${car.motor}</td>
          <td>${car.marca}</td> 
          <td>${car.agencia}</td> 
          <td>${car.color}</td> 
          <td>${car.asientos}</td> 
          <td>${car.placa}</td> 
          <td>${car.anio}</td> 
          <td>${car.precio}</td> 
          <td>${car.comprado ? "Comprado" : "Disponible"}</td> 

          <td>
            <img src='${car.imagen}' style='height:50px;'>
          </td> 

          <td>
            <input type='button' onclick='eliminarTabla("${car._id}")' value='Eliminar'>
          </td> 

          <td>
            <input type='button' class='botonesTab' value='Modificar' onclick='mostrarMod("${car._id}")'>
          </td>

          <td>
            <input type='button' ${car.comprado ? "disabled" : ""} onclick='buy("${car._id}", this)' value='Comprar'>
          </td> 
        </tr>
      `;
    }
  };

  const realizar = () => {
    Carroinstacia.modelo = document.getElementById('modelo').value;


    Carroinstacia.motor = document.getElementById('motor').value;


    Carroinstacia.marca = document.getElementById('marca').value;

    Carroinstacia.agencia = document.getElementById('agencia').value;


    Carroinstacia.color = document.getElementById('color').value;


    Carroinstacia.asientos = document.getElementById('asientos').value;


    Carroinstacia.placa = document.getElementById('placa').value;


    Carroinstacia.anio = document.getElementById('anio').value;


    Carroinstacia.precio = document.getElementById('precio').value;


    Carroinstacia.imagen = imagenes64;

    Carroinstacia.Guardar().then(
      function (response) {
        alert("Guardado con éxito");
        location.reload()
      },
      function (error) {
        console.error("Failed!", error);
        alert("Error al guardar" + error);
      }
    );
  };

  const mostrarMod = async (id) => {
    const response = await fetch(`/api/cars/${id}`);
    const json = await response.json();

    document.getElementById("modeloMod").value = json["modelo"];
    document.getElementById("motorMod").value =  json["motor"];
    document.getElementById("marcaMod").value =  json["marca"];
    document.getElementById("agenciaMod").value =  json["agencia"];
    document.getElementById("colorMod").value =  json["color"];
    document.getElementById("asientosMod").value =  json["asientos"];
    document.getElementById("placaMod").value =  json["placa"];
    document.getElementById("anioMod").value =  json["anio"];
    document.getElementById("precioMod").value =  json["precio"];

    document.getElementById('modificado').addEventListener('click', () => {
      Carroinstacia._id = id
      Carroinstacia.modelo = document.getElementById('modeloMod').value
      console.log(Carroinstacia.modelo)
      Carroinstacia.motor = document.getElementById('motorMod').value
      console.log(Carroinstacia.motor)
      Carroinstacia.marca = document.getElementById('marcaMod').value;
      console.log(Carroinstacia.marca)
      Carroinstacia.agencia = document.getElementById('agenciaMod').value
      console.log(Carroinstacia.agencia)
      Carroinstacia.color = document.getElementById('colorMod').value
      console.log(Carroinstacia.color)
      Carroinstacia.asientos = document.getElementById('asientosMod').value
      console.log(Carroinstacia.asientos)
      Carroinstacia.placa = document.getElementById('placaMod').value
      console.log(Carroinstacia.placa)
      Carroinstacia.anio = document.getElementById('anioMod').value
      console.log(Carroinstacia.anio)
      Carroinstacia.precio = document.getElementById('precioMod').value
      console.log(Carroinstacia.precio)
      Carroinstacia.imagen = imagenes64
      console.log(Carroinstacia.imagen)
      Carroinstacia.modificar().then(function (response) {
        alert('Modificado')
        location.reload()
      })
    })
  }

  const eliminarTabla = (obj) => {
    Carroinstacia._id = obj;
    Carroinstacia.Eliminar().then(function (response) {
      alert('Dato eliminado exitosamente');
      location.reload()
    })
  }

  const buy = (id, button) => {
    button.disabled = true;

    fetch(`/api/cars/buy/${id}`, {
      method: "POST"
    }).then((response) => {
      alert('Carro comprado');
      location.reload()
    }).catch((error) => console.log(error));
  };

  window.addEventListener("load", async () => {
    const response = await fetch("/api/cars/");
    const json = await response.json();

    fillTable(json);
  });

</script>



</html>